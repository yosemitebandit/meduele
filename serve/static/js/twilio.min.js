Twilio=typeof Twilio!="undefined"?Twilio:{};NS_MEDIASTREAM=NS_BEEP=NS_SOUND="Twilio";TWILIO_ROOT=typeof TWILIO_ROOT!="undefined"?TWILIO_ROOT:function(){for(var j=document.getElementsByTagName("script"),c=window.location.protocol||"http:",h=/(\w+:).*twilio\.(?:min\.)?js/,b=0;b<j.length;b++){var d=j[b].src.match(h);if(d){c=d[1]||c;break}}return c}()+"//static.twilio.com/libs/twiliojs/1.0/";
this.JSON||(JSON=function(){function j(b){return b<10?"0"+b:b}function c(b,d){var a,e,f,i;a=/["\\\x00-\x1f\x7f-\x9f]/g;var m;switch(typeof b){case "string":return a.test(b)?'"'+b.replace(a,function(o){var n=h[o];if(n)return n;n=o.charCodeAt();return"\\u00"+Math.floor(n/16).toString(16)+(n%16).toString(16)})+'"':'"'+b+'"';case "number":return isFinite(b)?String(b):"null";case "boolean":case "null":return String(b);case "object":if(!b)return"null";if(typeof b.toJSON==="function")return c(b.toJSON());
a=[];if(typeof b.length==="number"&&!b.propertyIsEnumerable("length")){i=b.length;for(e=0;e<i;e+=1)a.push(c(b[e],d)||"null");return"["+a.join(",")+"]"}if(d){i=d.length;for(e=0;e<i;e+=1){f=d[e];if(typeof f==="string")(m=c(b[f],d))&&a.push(c(f)+":"+m)}}else for(f in b)if(typeof f==="string")(m=c(b[f],d))&&a.push(c(f)+":"+m);return"{"+a.join(",")+"}"}}Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+j(this.getUTCMonth()+1)+"-"+j(this.getUTCDate())+"T"+j(this.getUTCHours())+":"+j(this.getUTCMinutes())+
":"+j(this.getUTCSeconds())+"Z"};var h={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:c,parse:function(b,d){function a(f,i){var m,o;if(i&&typeof i==="object")for(m in i)if(Object.prototype.hasOwnProperty.apply(i,[m])){o=a(m,i[m]);if(o!==undefined)i[m]=o}return d(f,i)}var e;if(/^[\],:{}\s]*$/.test(b.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){e=eval("("+
b+")");return typeof d==="function"?a("",e):e}throw new SyntaxError("parseJSON");}}}());
(function(j){j.Twilio=j.Twilio||{};j.Twilio._phpjs_atob=function(c){var h,b,d,a,e,f=0,i=0;a="";var m=[];if(!c)return c;c+="";do{h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(f++));b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(f++));a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(f++));e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(f++));d=
h<<18|b<<12|a<<6|e;h=d>>16&255;b=d>>8&255;d&=255;if(a==64)m[i++]=String.fromCharCode(h);else if(e==64)m[i++]=String.fromCharCode(h,b);else m[i++]=String.fromCharCode(h,b,d)}while(f<c.length);c=a=m.join("");f=[];h=m=e=a=i=0;for(c+="";i<c.length;){e=c.charCodeAt(i);if(e<128){f[a++]=String.fromCharCode(e);i++}else if(e>191&&e<224){m=c.charCodeAt(i+1);f[a++]=String.fromCharCode((e&31)<<6|m&63);i+=2}else{m=c.charCodeAt(i+1);h=c.charCodeAt(i+2);f[a++]=String.fromCharCode((e&15)<<12|(m&63)<<6|h&63);i+=3}}return a=
f.join("")};j.Twilio._phpjs_btoa=function(c){var h,b,d,a,e=0,f=0,i="";i=[];if(!c)return c;c+="";if(c===null||typeof c==="undefined")c="";else{c+="";h="";b=d=a=0;a=c.length;for(var m=0;m<a;m++){var o=c.charCodeAt(m),n=null;if(o<128)d++;else n=o>127&&o<2048?String.fromCharCode(o>>6|192)+String.fromCharCode(o&63|128):String.fromCharCode(o>>12|224)+String.fromCharCode(o>>6&63|128)+String.fromCharCode(o&63|128);if(n!==null){if(d>b)h+=c.slice(b,d);h+=n;b=d=m+1}}if(d>b)h+=c.slice(b,a);c=h}do{h=c.charCodeAt(e++);
b=c.charCodeAt(e++);d=c.charCodeAt(e++);a=h<<16|b<<8|d;h=a>>18&63;b=a>>12&63;d=a>>6&63;a&=63;i[f++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(a)}while(e<c.length);i=i.join("");switch(c.length%3){case 1:i=i.slice(0,-2)+"==";break;case 2:i=
i.slice(0,-1)+"="}return i}})(window);
var swfobject=function(){function j(){if(!I){try{var g=s.getElementsByTagName("body")[0].appendChild(s.createElement("span"));g.parentNode.removeChild(g)}catch(k){return}I=true;g=N.length;for(var l=0;l<g;l++)N[l]()}}function c(g){if(I)g();else N[N.length]=g}function h(g){if(typeof B.addEventListener!=w)B.addEventListener("load",g,false);else if(typeof s.addEventListener!=w)s.addEventListener("load",g,false);else if(typeof B.attachEvent!=w)A(B,"onload",g);else if(typeof B.onload=="function"){var k=
B.onload;B.onload=function(){k();g()}}else B.onload=g}function b(){var g=s.getElementsByTagName("body")[0],k=s.createElement(C);k.setAttribute("type",O);var l=g.appendChild(k);if(l){var p=0;(function(){if(typeof l.GetVariable!=w){var q=l.GetVariable("$version");if(q){q=q.split(" ")[1].split(",");r.pv=[parseInt(q[0],10),parseInt(q[1],10),parseInt(q[2],10)]}}else if(p<10){p++;setTimeout(arguments.callee,10);return}g.removeChild(k);l=null;d()})()}else d()}function d(){var g=F.length;if(g>0)for(var k=
0;k<g;k++){var l=F[k].id,p=F[k].callbackFn,q={success:false,id:l};if(r.pv[0]>0){var u=v(l);if(u)if(x(F[k].swfVersion)&&!(r.wk&&r.wk<312)){J(l,true);if(p){q.success=true;q.ref=a(l);p(q)}}else if(F[k].expressInstall&&e()){q={};q.data=F[k].expressInstall;q.width=u.getAttribute("width")||"0";q.height=u.getAttribute("height")||"0";if(u.getAttribute("class"))q.styleclass=u.getAttribute("class");if(u.getAttribute("align"))q.align=u.getAttribute("align");var t={};u=u.getElementsByTagName("param");for(var y=
u.length,z=0;z<y;z++)if(u[z].getAttribute("name").toLowerCase()!="movie")t[u[z].getAttribute("name")]=u[z].getAttribute("value");f(q,t,l,p)}else{i(u);p&&p(q)}}else{J(l,true);if(p){if((l=a(l))&&typeof l.SetVariable!=w){q.success=true;q.ref=l}p(q)}}}}function a(g){var k=null;if((g=v(g))&&g.nodeName=="OBJECT")if(typeof g.SetVariable!=w)k=g;else if(g=g.getElementsByTagName(C)[0])k=g;return k}function e(){return!P&&x("6.0.65")&&(r.win||r.mac)&&!(r.wk&&r.wk<312)}function f(g,k,l,p){P=true;V=p||null;X={success:false,
id:l};var q=v(l);if(q){if(q.nodeName=="OBJECT"){L=m(q);Q=null}else{L=q;Q=l}g.id=Y;if(typeof g.width==w||!/%$/.test(g.width)&&parseInt(g.width,10)<310)g.width="310";if(typeof g.height==w||!/%$/.test(g.height)&&parseInt(g.height,10)<137)g.height="137";s.title=s.title.slice(0,47)+" - Flash Player Installation";p=r.ie&&r.win?"ActiveX":"PlugIn";p="MMredirectURL="+B.location.toString().replace(/&/g,"%26")+"&MMplayerType="+p+"&MMdoctitle="+s.title;if(typeof k.flashvars!=w)k.flashvars+="&"+p;else k.flashvars=
p;if(r.ie&&r.win&&q.readyState!=4){p=s.createElement("div");l+="SWFObjectNew";p.setAttribute("id",l);q.parentNode.insertBefore(p,q);q.style.display="none";(function(){q.readyState==4?q.parentNode.removeChild(q):setTimeout(arguments.callee,10)})()}o(g,k,l)}}function i(g){if(r.ie&&r.win&&g.readyState!=4){var k=s.createElement("div");g.parentNode.insertBefore(k,g);k.parentNode.replaceChild(m(g),k);g.style.display="none";(function(){g.readyState==4?g.parentNode.removeChild(g):setTimeout(arguments.callee,
10)})()}else g.parentNode.replaceChild(m(g),g)}function m(g){var k=s.createElement("div");if(r.win&&r.ie)k.innerHTML=g.innerHTML;else if(g=g.getElementsByTagName(C)[0])if(g=g.childNodes)for(var l=g.length,p=0;p<l;p++)!(g[p].nodeType==1&&g[p].nodeName=="PARAM")&&g[p].nodeType!=8&&k.appendChild(g[p].cloneNode(true));return k}function o(g,k,l){var p,q=v(l);if(r.wk&&r.wk<312)return p;if(q){if(typeof g.id==w)g.id=l;if(r.ie&&r.win){var u="",t;for(t in g)if(g[t]!=Object.prototype[t])if(t.toLowerCase()==
"data")k.movie=g[t];else if(t.toLowerCase()=="styleclass")u+=' class="'+g[t]+'"';else if(t.toLowerCase()!="classid")u+=" "+t+'="'+g[t]+'"';t="";for(var y in k)if(k[y]!=Object.prototype[y])t+='<param name="'+y+'" value="'+k[y]+'" />';q.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+u+">"+t+"</object>";R[R.length]=g.id;p=v(g.id)}else{y=s.createElement(C);y.setAttribute("type",O);for(var z in g)if(g[z]!=Object.prototype[z])if(z.toLowerCase()=="styleclass")y.setAttribute("class",
g[z]);else z.toLowerCase()!="classid"&&y.setAttribute(z,g[z]);for(u in k)if(k[u]!=Object.prototype[u]&&u.toLowerCase()!="movie"){g=y;t=u;z=k[u];l=s.createElement("param");l.setAttribute("name",t);l.setAttribute("value",z);g.appendChild(l)}q.parentNode.replaceChild(y,q);p=y}}return p}function n(g){var k=v(g);if(k&&k.nodeName=="OBJECT")if(r.ie&&r.win){k.style.display="none";(function(){if(k.readyState==4){var l=v(g);if(l){for(var p in l)if(typeof l[p]=="function")l[p]=null;l.parentNode.removeChild(l)}}else setTimeout(arguments.callee,
10)})()}else k.parentNode.removeChild(k)}function v(g){var k=null;try{k=s.getElementById(g)}catch(l){}return k}function A(g,k,l){g.attachEvent(k,l);K[K.length]=[g,k,l]}function x(g){var k=r.pv;g=g.split(".");g[0]=parseInt(g[0],10);g[1]=parseInt(g[1],10)||0;g[2]=parseInt(g[2],10)||0;return k[0]>g[0]||k[0]==g[0]&&k[1]>g[1]||k[0]==g[0]&&k[1]==g[1]&&k[2]>=g[2]?true:false}function Z(g,k,l,p){if(!(r.ie&&r.mac)){var q=s.getElementsByTagName("head")[0];if(q){l=l&&typeof l=="string"?l:"screen";if(p)W=D=null;
if(!D||W!=l){p=s.createElement("style");p.setAttribute("type","text/css");p.setAttribute("media",l);D=q.appendChild(p);if(r.ie&&r.win&&typeof s.styleSheets!=w&&s.styleSheets.length>0)D=s.styleSheets[s.styleSheets.length-1];W=l}if(r.ie&&r.win)D&&typeof D.addRule==C&&D.addRule(g,k);else D&&typeof s.createTextNode!=w&&D.appendChild(s.createTextNode(g+" {"+k+"}"))}}}function J(g,k){if($){var l=k?"visible":"hidden";if(I&&v(g))v(g).style.visibility=l;else Z("#"+g,"visibility:"+l)}}function aa(g){return/[\\\"<>\.;]/.exec(g)!=
null&&typeof encodeURIComponent!=w?encodeURIComponent(g):g}var w="undefined",C="object",O="application/x-shockwave-flash",Y="SWFObjectExprInst",B=window,s=document,G=navigator,ba=false,N=[function(){ba?b():d()}],F=[],R=[],K=[],L,Q,V,X,I=false,P=false,D,W,$=true,r=function(){var g=typeof s.getElementById!=w&&typeof s.getElementsByTagName!=w&&typeof s.createElement!=w,k=G.userAgent.toLowerCase(),l=G.platform.toLowerCase(),p=l?/win/.test(l):/win/.test(k);l=l?/mac/.test(l):/mac/.test(k);k=/webkit/.test(k)?
parseFloat(k.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false;var q=!+"\u000b1",u=[0,0,0],t=null;if(typeof G.plugins!=w&&typeof G.plugins["Shockwave Flash"]==C){if((t=G.plugins["Shockwave Flash"].description)&&!(typeof G.mimeTypes!=w&&G.mimeTypes[O]&&!G.mimeTypes[O].enabledPlugin)){ba=true;q=false;t=t.replace(/^.*\s+(\S+\s+\S+$)/,"$1");u[0]=parseInt(t.replace(/^(.*)\..*$/,"$1"),10);u[1]=parseInt(t.replace(/^.*\.(.*)\s.*$/,"$1"),10);u[2]=/[a-zA-Z]/.test(t)?parseInt(t.replace(/^.*[a-zA-Z]+(.*)$/,
"$1"),10):0}}else if(typeof B.ActiveXObject!=w)try{var y=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(y)if(t=y.GetVariable("$version")){q=true;t=t.split(" ")[1].split(",");u=[parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10)]}}catch(z){}return{w3:g,pv:u,wk:k,ie:q,win:p,mac:l}}();(function(){if(r.w3){if(typeof s.readyState!=w&&s.readyState=="complete"||typeof s.readyState==w&&(s.getElementsByTagName("body")[0]||s.body))j();if(!I){typeof s.addEventListener!=w&&s.addEventListener("DOMContentLoaded",
j,false);if(r.ie&&r.win){s.attachEvent("onreadystatechange",function(){if(s.readyState=="complete"){s.detachEvent("onreadystatechange",arguments.callee);j()}});B==top&&function(){if(!I){try{s.documentElement.doScroll("left")}catch(g){setTimeout(arguments.callee,0);return}j()}}()}r.wk&&function(){I||(/loaded|complete/.test(s.readyState)?j():setTimeout(arguments.callee,0))}();h(j)}}})();(function(){r.ie&&r.win&&window.attachEvent("onunload",function(){for(var g=K.length,k=0;k<g;k++)K[k][0].detachEvent(K[k][1],
K[k][2]);g=R.length;for(k=0;k<g;k++)n(R[k]);for(var l in r)r[l]=null;r=null;for(var p in swfobject)swfobject[p]=null;swfobject=null})})();return{registerObject:function(g,k,l,p){if(r.w3&&g&&k){var q={};q.id=g;q.swfVersion=k;q.expressInstall=l;q.callbackFn=p;F[F.length]=q;J(g,false)}else p&&p({success:false,id:g})},getObjectById:function(g){if(r.w3)return a(g)},embedSWF:function(g,k,l,p,q,u,t,y,z,M){var S={success:false,id:k};if(r.w3&&!(r.wk&&r.wk<312)&&g&&k&&l&&p&&q){J(k,false);c(function(){l+="";
p+="";var H={};if(z&&typeof z===C)for(var E in z)H[E]=z[E];H.data=g;H.width=l;H.height=p;E={};if(y&&typeof y===C)for(var T in y)E[T]=y[T];if(t&&typeof t===C)for(var U in t)if(typeof E.flashvars!=w)E.flashvars+="&"+U+"="+t[U];else E.flashvars=U+"="+t[U];if(x(q)){T=o(H,E,k);H.id==k&&J(k,true);S.success=true;S.ref=T}else if(u&&e()){H.data=u;f(H,E,k,M);return}else J(k,true);M&&M(S)})}else M&&M(S)},switchOffAutoHideShow:function(){$=false},ua:r,getFlashPlayerVersion:function(){return{major:r.pv[0],minor:r.pv[1],
release:r.pv[2]}},hasFlashPlayerVersion:x,createSWF:function(g,k,l){if(r.w3)return o(g,k,l)},showExpressInstall:function(g,k,l,p){r.w3&&e()&&f(g,k,l,p)},removeSWF:function(g){r.w3&&n(g)},createCSS:function(g,k,l,p){r.w3&&Z(g,k,l,p)},addDomLoadEvent:c,addLoadEvent:h,getQueryParamValue:function(g){var k=s.location.search||s.location.hash;if(k){if(/\?/.test(k))k=k.split("?")[1];if(g==null)return aa(k);k=k.split("&");for(var l=0;l<k.length;l++)if(k[l].substring(0,k[l].indexOf("="))==g)return aa(k[l].substring(k[l].indexOf("=")+
1))}return""},expressInstallCallback:function(){if(P){var g=v(Y);if(g&&L){g.parentNode.replaceChild(L,g);if(Q){J(Q,true);if(r.ie&&r.win)L.style.display="block"}V&&V(X)}P=false}}}}();
(function(j){function c(){this.__id=c.__nextId++;var a=function(){};this.onclose=this.onerror=this.onopen=a;c.__instances[this.__id]=this}if(swfobject.hasFlashPlayerVersion("10.0.0")){c.prototype={open:function(){var a=this,e=Array.prototype.slice.call(arguments);c.__queue(function(){c.__flash.open.apply(c.__flash,[a.__id].concat(e))})},exec:function(){var a=this,e=Array.prototype.slice.call(arguments);c.__queue(function(){c.__flash.exec.apply(c.__flash,[a.__id].concat(e))})},close:function(){var a=
this;c.__queue(function(){c.__flash.close(a.__id)})},play:function(){var a=this,e=Array.prototype.slice.call(arguments);c.__queue(function(){c.__flash.playStream.apply(c.__flash,[a.__id].concat(e))})},publish:function(a,e){var f=this;c.__queue(function(){c.__flash.publish(f.__id,a,e)})},attachAudio:function(a){var e=this;c.__queue(function(){c.__flash.attachAudio(e.__id,a)})},detachAudio:function(){var a=this;c.__queue(function(){c.__flash.detachAudio(a.__id)})},__handleEvent:function(a){switch(a.type){case "gatewayError":case "securityError":case "asyncError":case "ioError":this.onerror.call(this,
a);break;case "netStatus":this.__handleNetStatus(a)}},__handleNetStatus:function(a){c.log("Event info code: "+a.info.code);switch(a.info.code){case "NetConnection.Connect.Failed":case "NetConnection.Connect.Rejected":c.log("Connection failed or was rejected");this.onerror.call(this,a);break;case "NetConnection.Connect.Closed":c.log("Connection closed");this.onclose.call(this,a);break;case "NetConnection.Connect.Success":c.log("Connection established");this.onopen.call(this);break;default:c.log("Unexpected event: "+
a.info.code)}}};var h={__queue:function(a){c.initialized?a():c.__tasks.push(a)},initialize:function(a){if(!c.__flash)if(document.body){a=a||{};a.swfLocation=a.swfLocation||"MediaStreamMain.swf";a.domId=a.domId||"__connectionFlash__";var e=document.createElement("div");e.id=a.domId;if(a.loader)a.loader.call(null,e);else{var f=document.createElement("div");f.style.position="absolute";f.appendChild(e);document.body.appendChild(e)}c.__flash=e;e={};if("objectEnc"in a)e.objectEnc=a.objectEnc;e.namespace=
window.NS_MEDIASTREAM?window.NS_MEDIASTREAM+".MediaStream":"MediaStream";swfobject.embedSWF(a.swfLocation,a.domId,"215","138","10.0.0",null,e,{hasPriority:true,allowScriptAccess:"always"},null,function(m){c.log("Embed "+(m.success?"succeeded":"failed"))})}else try{window.addEventListener("load",function(){c.initialize(a)},false)}catch(i){window.attachEvent("onload",function(){c.initialize(a)})}},setMicrophoneGain:function(a){c.__queue(function(){try{c.__flash.setMicrophoneGain(a)}catch(e){c.log(e)}})},
setMicrophone:function(a){c.__queue(function(){c.__flash.setMicrophone(a)})},getMicrophone:function(){return c.initialized?c.__flash.getMicrophone():null},getMicrophones:function(){return c.initialized?c.__flash.getMicrophones():[]},setUseEchoSuppression:function(a){c.__queue(function(){try{c.__flash.setUseEchoSupression(a)}catch(e){c.log(e)}})},setSilenceLevel:function(a,e){c.__queue(function(){try{c.__flash.setSilenceLevel(a,e)}catch(f){c.log(f)}})},showSettings:function(){c.__queue(function(){c.__flash.showSettings()})},
isMicMuted:function(){try{return c.__flash.isMicMuted()}catch(a){if(!(a instanceof TypeError))throw a;}},log:function(a,e,f){if(c.__debug&&window.console){f=f||"log";console[f]("[MediaStream] "+a);if(typeof e!="undefined")console[f](e)}}},b={__onFlashInitialized:function(){c.initialized=true;c.__flash=document.getElementById(c.__flash.id);setTimeout(function(){c.__flash.setDebug(c.__debug);c.setMicrophone(-1);var a=c.getMicrophone();c.log(a?"Using "+a:"No mics available");c.setMicrophoneGain(75);
for(a=0;a<c.__tasks.length;a++)c.__tasks[a].call()},0)},__onMediaStreamEvent:function(){setTimeout(function(){for(var a=c.__flash.dequeueEvents(),e=0;e<a.length;e++)try{c.log("Received event: "+a[e].type);c.__instances[a[e].mediaStreamId].__handleEvent(a[e])}catch(f){c.log("Error while processing "+a[e].type+": "+f.message,f,"error")}},0)},__onLog:function(a){a.level=="error"?c.log(a.message,undefined,"error"):c.log(a.message)}},d;for(d in h)c[d]=h[d];for(d in b)c[d]=b[d];c.__nextId=0;c.__flash=null;
c.__instances={};c.__tasks=[];c.__debug=false;c.initialized=false;c.AMF0=0;c.AMF3=3;j.MediaStream=c}else window.console&&console.error("Flash Player >= 10.0.0 is required.")})(window[window.NS_MEDIASTREAM]||window);
(function(j){function c(b){if(!(this instanceof c))return new c(b);if(typeof b!="number"||b<1)return null;this.channels=1;this.bitdepth=16;this.samplerate=b;this.sine=[];for(var d=2*Math.PI/parseFloat(b),a=0;a<b;a++)this.sine.push(Math.sin(a*d))}var h={amplify:function(b){return function(d){return d*b}},ushort:function(b){return String.fromCharCode(255&b,255&b>>8)},ulong:function(b){return String.fromCharCode(255&b,255&b>>8,255&b>>16,255&b>>24)},gcd:function(b,d){for(;d;){var a=b;b=d;d=a%d}return b},
lcm:function(b,d){return Math.floor(b*d/h.gcd(b,d))},compose:function(b){return function(d){for(var a=0;a<b.length;a++)d=b[a](d);return d}},map:function(b,d){for(var a=[],e=0;e<d.length;e++)a.push(b.call(this,d[e]));return a},getattr:function(b){return function(d){return d[b]}},zip:function(){if(arguments.length==0)return[];for(var b=Array.prototype.slice.call(arguments),d=[],a=Math.min.apply(null,h.map(h.getattr("length"),b)),e=0;e<a;e++)d.push(h.map(h.getattr(e),b));return d},sum:function(b){return h.foldl(function(d,
a){return d+a},b)},bind:function(b,d){return function(){var a=Array.prototype.slice.call(arguments);return d.apply(b,a)}},foldl:function(b,d){if(d.length==1)return d[0];for(var a=b(d[0],d[1]),e=2;e<d.length;e++)a=b(a,d[e]);return a},mulmod:function(b,d,a){return b*d%a},range:function(b){for(var d=[],a=0;a<b;a++)d.push(a);return d}};c.prototype={generate:function(b){b=b instanceof Array?b:[b];var d=h.bind(this,h.map),a=d(function(f){return h.lcm(this.samplerate,f)/f},b);a=h.foldl(h.lcm,a);var e=function(f){return function(i){return this.sine[h.mulmod(f,
i,this.samplerate)]}};return d(function(f){return h.sum(d(e(f),b))},h.range(a))},encode:function(b,d,a){b=b instanceof Array?b:[b];a=h.compose((a||[]).concat([h.ushort]));b=h.map(a,this.generate(b));b=Array(Math.ceil(d*this.samplerate/b.length)+1).join(b.join("")).substr(0,this.samplerate*d*2);d=["fmt ",h.ulong(c.PCM_CHUNK_SIZE),h.ushort(c.LINEAR_QUANTIZATION),h.ushort(this.channels),h.ulong(this.samplerate),h.ulong(this.samplerate*this.channels*this.bitdepth/8),h.ushort(this.bitdepth/8),h.ushort(this.bitdepth)].join("");
b=["data",h.ulong(b.length*this.channels*this.bitdepth/8),b].join("");return[["RIFF",h.ulong(4+(8+d.length)+(8+b.length)),"WAVE"].join(""),d,b].join("")},play:function(b,d,a){a=a||[];b=btoa(this.encode(b,d,a));d=document.createElement("audio");d.src="data:audio/x-wav;base64,"+b;d.play()}};c.LINEAR_QUANTIZATION=1;c.PCM_CHUNK_SIZE=16;c.utils=h;j.Beep=c})(window[window.NS_BEEP]||window);
(function(j){function c(){this.id=c.nextId++;c.items[this.id]=this;this.create()}swfobject.hasFlashPlayerVersion("10.0.0")||window.console&&console.error("Flash Player >= 10.0.0 is required");c.prototype={create:function(){var a=this.id;c.queue(function(){c.flash.__create(a)})},play:function(a,e){a=a||0;e=e||0;var f=this.id;c.queue(function(){c.flash.__play(f,a,e)})},load:function(a){var e=this.id;c.queue(function(){c.flash.__load(e,a)})},stop:function(){var a=this.id;c.queue(function(){c.flash.__stop(a)})},
destroy:function(){var a=this.id;c.queue(function(){c.flash.__destroy(a);delete c.items[a]})}};var h={initialize:function(a){a=a||{};a.swfLocation=a.swfLocation||"SoundMain.swf";a.domId=a.domId||"__soundFlash__";if(!c.flash)if(document.body){var e=document.createElement("div");e.id=a.domId;document.body.appendChild(e);c.flash=e;swfobject.embedSWF(a.swfLocation,a.domId,"1","1","10.0.0",null,{namespace:window.NS_SOUND?window.NS_SOUND+".Sound":"Sound"},{hasPriority:true,allowScriptAccess:"always"},null,
function(i){c.log("Embed "+(i.success?"succeeded":"failed"))})}else try{window.addEventListener("load",function(){c.initialize(a)},false)}catch(f){window.attachEvent("onload",function(){c.initialize(a)})}},log:function(a,e,f){if(c.debug&&window.console){f=f||"log";console[f]("[Sound] "+a);if(typeof e!="undefined")console[f](e)}},queue:function(a){c.initialized?a():c.tasks.push(a)}},b={__onFlashInitialized:function(){c.initialized=true;c.flash=document.getElementById(c.flash.id);setTimeout(function(){c.flash.__setDebug(c.debug);
c.log("Initialized and ready");for(var a=0;a<c.tasks.length;a++)c.tasks[a]()},0)},__onLog:function(a){c.log(a)}},d;for(d in h)c[d]=h[d];for(d in b)c[d]=b[d];c.nextId=0;c.debug=false;c.tasks=[];c.items={};j.Sound=c})(window[window.NS_SOUND]||window);
(function(j){function c(f){return function(){var i=Array.prototype.slice.call(arguments,0);f.memo=f.memo||{};return f.memo[i]?f.memo[i]:f.memo[i]=f.apply(null,i)}}function h(f){f=f.split(".");if(f.length!=3)throw new j.Exception("Wrong number of segments");return a(f[1])}function b(f){if(f=="")return{};if(f.indexOf("&")==-1&&f.indexOf("=")==-1)return f;f=f.split("&");for(var i={},m=0;m<f.length;m++){var o=f[m].split("=");i[o[0]]=b(decodeURIComponent(o[1]))}return i}function d(f){if(!(this instanceof
d))return new d(f);this.message=f}var a=c(function(f){var i=f.length%4;if(i>0)f+=Array(4-i+1).join("=");f=f.replace(/-/g,"+").replace(/_/g,"/");f=j.atob(f);return JSON.parse(f)}),e=c(function(f){f=h(f);for(var i=f.scope.split(" "),m={},o=0;o<i.length;o++){var n;n=i[o].match(/^scope:(\w+):(\w+)\??(.*)$/);if(!(n&&n.length==4))throw new j.Exception("Bad scope URI");n={service:n[1],privilege:n[2],params:b(n[3])};m[n.service+":"+n.privilege]=n}f.scope=m;return f});d.prototype.toString=function(){return"Twilio.Exception: "+
this.message};j.Exception=d;j.decode=h;j.btoa=function(f){try{return btoa(f)}catch(i){return j._phpjs_btoa(f)}};j.atob=function(f){try{return atob(f)}catch(i){return j._phpjs_atob(f)}};j.decorate=function(){var f=Array.prototype.slice.call(arguments),i=f.shift(),m=f.shift();if(i&&m){for(var o=i[m],n=0;n<f.length;n++)o=(0,f[n])(o);i[m]=o}};j.objectize=e;j.urlencode=function(f,i){var m=[];i=i||false;for(var o in f)if(i&&f[o]instanceof Array)for(var n in f[o]){var v=f[o][n];m.push(encodeURIComponent(o)+
"="+encodeURIComponent(v))}else{v=f[o];m.push(encodeURIComponent(o)+"="+encodeURIComponent(v))}return m.join("&")}})(Twilio);
(function(j){function c(b,d){return function(){var a=Array.prototype.slice(arguments);d.apply(b,a)}}function h(){if(!(this instanceof h))return new h;this.cache={}}h.prototype={add:function(b,d,a){a=a||{};if(!(a instanceof Object))throw new TypeError("Bad envelope type; expected Object");d instanceof Array||(d=[d]);for(var e=0;e<d.length;e++)if(!(d[e]instanceof j.Sound))throw new TypeError("Expected an instance of Twilio.Sound");this.cache[b]={starttime:null,sounds:d,envelope:a}},play:function(b,
d,a){d=d||0;a=a||1;if(b in this.cache){b=this.cache[b];for(var e=0;e<b.sounds.length;e++)b.sounds[e].play(d,a);b.starttime=(new Date).getTime()}},stop:function(b){if(b in this.cache){var d=this.cache[b];b=d.envelope.release||0;var a=function(){for(var f=0;f<d.sounds.length;f++)d.sounds[f].stop()},e=(new Date).getTime();e=Math.max(0,b-(e-d.starttime));b==0?a():setTimeout(a,e)}},playseq:function(){var b=null,d=[],a=function(){var e=d.shift();if(e){var f=e[0],i=e[1]||0;e=e[2]||0;f in this.cache&&j.Device.instance.soundcache.play(f);
b=window.setTimeout(c(this,a),i+e)}else b=null};return function(e){for(var f=0;f<e.length;f++)d.push(e[f]);if(b==null)b=window.setTimeout(c(this,a),0)}}()};j.SoundCache=h})(Twilio);
(function(j){function c(h){if(!(this instanceof c))return new c(h);h=h||{};var b=function(){};b={interval:10,onsleep:b,onwakeup:b};for(var d in b)d in h||(h[d]=b[d]);this.interval=h.interval;this.lastbeat=0;this.pintvl=null;this.onsleep=h.onsleep;this.onwakeup=h.onwakeup}c.toString=function(){return"[Twilio.Heartbeat class]"};c.prototype={toString:function(){return"[Twilio.Heartbeat instance]"},beat:function(){this.lastbeat=(new Date).getTime();if(this.sleeping()){if(this.onwakeup)this.onwakeup();
this.pintvl=window.setInterval(function(h){return function(){h.check()}}(this),this.interval*1E3)}},check:function(){var h=(new Date).getTime()-this.lastbeat;if(!this.sleeping()&&h>this.interval*1E3){if(this.onsleep)this.onsleep();window.clearInterval(this.pintvl);this.pintvl=null}},sleeping:function(){return this.pintvl==null}};j.Heartbeat=c})(Twilio);
(function(j){j.mixinLog=function(c,h){function b(){if(b.enabled)for(var d=b.prefix?b.prefix+" ":"",a=0;a<arguments.length;a++){var e=arguments[a];b.handler(typeof e=="string"?d+e:e)}}b.enabled=true;b.prefix=h||"";b.defaultHandler=function(d){window.console&&console.log(d)};b.handler=b.defaultHandler;c.log=b}})(Twilio);
(function(j){function c(b,d,a){d=d||[];if(d.length==0)return-1;if(!a&&d.indexOf)return d.indexOf(b);else{for(a=0;a<d.length;a++)if(d[a]===b)return a;return-1}}var h={addListener:function(b,d){if(typeof d!="function")throw new j.Exception("Listener must be a function, not "+typeof d);this.handlers[b]=this.handlers[b]||[];this.handlers[b].push(d);this.log('Registered listener for event type "'+b+'"');return this},hasListener:function(b,d){return c(d,this.handlers[b])!=-1},removeListener:function(b,
d){var a=c(d,this.handlers[b]);if(a>-1){this.handlers[b].splice(a,1);this.log('Removed listener for event type "'+b+'"')}return this},fire:function(){var b=Array.prototype.slice.call(arguments,0),d=b.shift(),a=this.handlers[d]||[];this.log('Invoke listeners for event type "'+d+'"');for(d=0;d<a.length;d++)a[d].apply(this,b)}};j.mixinEventEmitter=function(b){b.handlers=b.handlers||{};b.log=b.log||function(){};for(var d in h)b[d]||(b[d]=function(a,e){return function(){var f=Array.prototype.slice.call(arguments,
0);return h[e].apply(a,f)}}(b,d))}})(Twilio);
(function(j){function c(b,d){if(!b.fire||!b.addListener)throw new j.Exception("Object is not event savvy");return function(){var a=Array.prototype.slice.call(arguments,0);if(typeof a[0]=="function")return b.addListener(d,a[0]);else{a.unshift(d);return b.fire.apply(b,a)}}}function h(b,d){if(!(this instanceof h))return new h(b,d);var a={logPrefix:"[EventStream]",socketFactory:null,scheme:"wss",host:"stream.twilio.com",swfLocation:TWILIO_ROOT+"WebSocket.swf",socket:null,reconnect:true,url:null,flashTimeout:5E3,
filters:{},debug:false};d=d||{};for(var e in a)e in d||(d[e]=a[e]);this.options=d;this.token=b||"";this.handlers={};this.status="offline";j.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;if(!h.initializingFlash)if(document.body)h.initializeFlash(this);else{var f=this;window.addEventListener?window.addEventListener("load",function(){h.initializeFlash(f)},false):window.attachEvent("onload",function(){h.initializeFlash(f)})}this.heartbeat=new j.Heartbeat({interval:15});this._connect();
j.mixinEventEmitter(this);a=["incoming","ready","offline","sms","call","twiml","error"];for(e=0;e<a.length;e++)this[a[e]]=c(this,a[e]);f=this;this.addListener("publish",function(i){f.fire("twiml",i)})}h.initializingFlash=false;h.initializeFlash=function(b){if(!h.initializingFlash){h.initializingFlash=true;if(window.WebSocket&&window.WebSocket.__initialize){WEB_SOCKET_SWF_LOCATION=b.options.swfLocation;window.WebSocket.__initialize();b.log("Waiting "+b.options.flashTimeout+"ms for flash to initialize");
window.setTimeout(function(){window.WebSocket.__flash||b.log("WebSocket did not initialize")},b.options.flashTimeout)}}};h.toString=function(){return"[Twilio.EventStream class]"};h.prototype={toString:function(){return"[Twilio.EventStream instance]"},destroy:function(){this.socket.close();this.heartbeat.onsleep=null;this.options.reconnect=false;return this},_connect:function(){var b=this,d=this._extractUrl();if(d){this.log("Attempting to connect to "+d+"...");this.socket=this.options.socketFactory?
this.options.socketFactory(d):new WebSocket(d);this.socket.onopen=function(){b.log("Socket opened... sending ready signal");b.socket.send(JSON.stringify({"rt.message":"listen","rt.token":b.token}))};this.socket.onerror=function(a){a.data?b.fire("error",{message:a.data.message||"",code:a.data.code||""}):b.log("Received message event:",a)};this.socket.onmessage=function(a){b.heartbeat.beat();if(a.data!="\n"){a=a.data;a=typeof a!="string"?"":a.trim?a.trim():a.replace(/^\s+|\s+$/g,"");a=a.length==0?[]:
a.split("\n");for(var e=0;e<a.length;e++){var f=JSON.parse(a[e]);if(f["rt.message"]=="ready"){b.status="ready";b.fire("ready",b)}else{var i=f["rt.message"]||f.EventType;if(i=="error"&&/^4/.test(f.code))b.options.reconnect=false;i!="incoming"&&b.fire("incoming",f);b.fire(i,f)}}}};this.socket.onclose=function(){b.log("Gone offline");b.status="offline";b.fire("offline",b)};this.heartbeat.onsleep=function(){b.socket.close();b._tryReconnect(5E3)}}else this.log("Nothing to do")},_extractUrl:function(){if(this.options.url)return this.options.url;
var b=j.objectize(this.token).scope;if(!("stream:subscribe"in b))return null;b=b["stream:subscribe"];b=b.params&&b.params.path?b.params.path:"/";var d=this.options.filters;d.AccessToken=this.token;return this.options.scheme+"://"+this.options.host+b+"?"+j.urlencode(d,true)},_tryReconnect:function(b){(new Date).getTime();if(!(!this.options.reconnect||this._extractUrl()==null)){b=b||5E3;this._connect();var d=function(e){return function(){e._tryReconnect(b*2)}}(this),a=function(e){return function(){e.socket.readyState==
2&&window.setTimeout(d,b)}}(this);window.setTimeout(a,5E3)}}};h=function(b){var d=[],a=function(i){if(b.instance)return i();d.push(i)},e={instance:null,status:"offline",setup:function(i,m){b.instance=new b(i,m);for(var o=0;o<d.length;o++)d[o]();b.ready(function(){b.status="ready"});b.offline(function(){b.status="offline"});return b},incoming:function(i){a(function(){b.instance.incoming(i)});return b},ready:function(i){a(function(){b.instance.ready(i)});return b},offline:function(i){a(function(){b.instance.offline(i)});
return b},sms:function(i){a(function(){b.instance.sms(i)});return b},call:function(i){a(function(){b.instance.call(i)});return b},twiml:function(i){a(function(){b.instance.twiml(i)});return b},error:function(i){a(function(){b.instance.error(i)});return b}},f;for(f in e)b[f]=e[f];return b}(h);WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=true;j.EventStream=h})(Twilio);
(function(j){function c(b,d,a){if(!(this instanceof c))return new c(d,a);this.device=b;this.message=d||{};a=a||{};b={logPrefix:"[Connection]",bridgeToken:null,chunder:"chunder.prod.twilio.com",debug:false,secure:false,mediaStream:null,swfLocation:TWILIO_ROOT+"MediaStreamMain.swf",loader:function(i){c.dialog.insert(i)},token:null,objectEnc:j.MediaStream.AMF0};for(var e in b)e in a||(a[e]=b[e]);this.options=a;this.parameters={};this._status=this.options.bridgeToken?"pending":"closed";j.mixinLog(this,
this.options.logPrefix);this.log.enabled=this.options.debug;j.mixinEventEmitter(this);if(!j.MediaStream.initialized){j.MediaStream.__debug=this.options.debug;j.MediaStream.setSilenceLevel(0,200);j.MediaStream.initialize({swfLocation:this.options.swfLocation,domId:"__mediaStreamContainer__",loader:this.options.loader,objectEnc:this.options.objectEnc})}this.mediaStream=this.options.mediaStream||new j.MediaStream;var f=this;this.mediaStream.onerror=function(i){var m={code:i.info.code,message:i.info.message,
info:i.info};f.log("Received an error from MediaStream:",i);f.fire("error",m)};this.mediaStream.onopen=function(){f._status="open";f.fire("accept",f);f.mediaStream.publish("input","live");f.mediaStream.attachAudio();f.mediaStream.play("output")};this.mediaStream.onclose=function(){f._status="closed";f.device.sounds.disconnect()&&f.device.soundcache.play("disconnect");f.fire("disconnect",f)}}function h(){var b=document.createElement("div"),d=document.createElement("div"),a=document.createElement("button");
b.style.position="fixed";b.style.zIndex="99999";b.style.top="0";b.style.left="0";b.style.width="1px";b.style.height="1px";b.style.overflow="hidden";b.style.visibility="hidden";d.style.margin="10% auto 0";d.style.width="215px";d.style.borderRadius="8px";d.style.backgroundColor="#f8f8f8";d.style.border="8px solid rgb(160, 160, 160)";var e=this,f=function(){e.hide();e.closeCb&&e.closeCb.call()};a.appendChild(document.createTextNode("Close"));window.addEventListener?a.addEventListener("click",f,false):
a.attachEvent("onclick",f);b.appendChild(d);d.appendChild(a);this.screen=b;this.dialog=d;this.close=a;this.container=null;if(document.body)document.body.appendChild(b);else{d=function(){document.body.appendChild(b)};window.addEventListener?window.addEventListener("load",d,false):window.attachEvent("onload",d)}}c.toString=function(){return"[Twilio.Connection class]"};c.prototype={toString:function(){return"[Twilio.Connection instance]"},sendDigits:function(b){if(b.match(/[^0-9*#w]/))throw new j.Exception("Illegal character passed into sendDigits");
this.mediaStream.exec("sendDTMF",b);for(var d=[],a=0;a<b.length;a++){var e=b[a]!="w"?"dtmf"+b[a]:"";if(e=="dtmf*")e="dtmfs";if(e=="dtmf#")e="dtmfh";d.push([e,200,20])}this.device.soundcache.playseq(d)},status:function(){return this._status},mute:function(){this.mediaStream.detachAudio()},unmute:function(){this.mediaStream.attachAudio()},accept:function(b){if(typeof b=="function")return this.addListener("accept",b);var d=this;this._showMicDialogIfMuted(function(){if(j.MediaStream.isMicMuted())d._die("Access to microphone has been denied");
else{var a=[],e;for(e in d.message)a.push(e+"="+encodeURIComponent(d.message[e]));d.mediaStream.open((d.options.secure?"rtmps":"rtmp")+"://"+d.options.chunder+"/chunder",d.options.token,d.options.bridgeToken,a.join("&"))}})},cancel:function(b){if(typeof b=="function")return this.addListener("cancel",b);this._status="closed";this.fire("cancel")},disconnect:function(b){if(typeof b=="function")return this.addListener("disconnect",b);if(this._status=="open"){this.log("Disconnecting...");this.mediaStream.close()}},
error:function(b){if(typeof b=="function")return this.addListener("error",b)},_showMicDialogIfMuted:function(b){var d=this;j.MediaStream.__queue(function(){if(j.MediaStream.getMicrophones().length==(j.Connection.NO_MIC_LEVEL||0))d._die("No microphone is available");else if(j.MediaStream.isMicMuted()){c.dialog.show(b);j.MediaStream.showSettings()}else b.call()})},_die:function(b){this._status="pending";this.fire("error",{message:b})}};h.prototype={insert:function(b){if(this.container){if(this.container==
b)return;this.dialog.removeChild(this.container)}this.container=b;this.dialog.insertBefore(b,this.close)},show:function(b){this.closeCb=b;this.screen.style.width="100%";this.screen.style.height="auto";this.screen.style.visibility="visible";this.container.style.marginLeft=window.outerWidth%2==0?"0":"0.5px"},hide:function(){this.screen.style.width="1px";this.screen.style.height="1px";this.screen.style.visibility="hidden"}};c.dialog=new h;j.Connection=c})(Twilio);
(function(j){function c(a){if(!(this instanceof c))return new c(a);this.__dict__={};a=a||{};for(var e in a){this[e]=this.makeprop(this.__dict__,e);this[e](a[e])}}function h(a,e){if(!(this instanceof h))return new h(a,e);var f={logPrefix:"[Device]",host:"chunder.twilio.com",eventsScheme:"wss",eventsHost:"matrix.twilio.com",soundSwfLocation:TWILIO_ROOT+"SoundMain.swf",connectionFactory:null,connectionOptions:{},stream:null,secure:false,debug:false,objectEnc:j.MediaStream.AMF0};e=e||{};for(var i in f)i in
e||(e[i]=f[i]);this.options=e;this.token=a||"";this._status="offline";this.connections=[];this.stream=null;this.sounds=new c({incoming:true,outgoing:true,disconnect:true});this.soundcache=new j.SoundCache;f={incoming:"sounds/incoming.mp3",outgoing:"sounds/outgoing.mp3",disconnect:"sounds/disconnect.mp3",dtmf1:"sounds/dtmf-1.mp3",dtmf2:"sounds/dtmf-2.mp3",dtmf3:"sounds/dtmf-3.mp3",dtmf4:"sounds/dtmf-4.mp3",dtmf5:"sounds/dtmf-5.mp3",dtmf6:"sounds/dtmf-6.mp3",dtmf7:"sounds/dtmf-7.mp3",dtmf8:"sounds/dtmf-8.mp3",
dtmf9:"sounds/dtmf-9.mp3",dtmf0:"sounds/dtmf-0.mp3",dtmfs:"sounds/dtmf-star.mp3",dtmfh:"sounds/dtmf-hash.mp3"};for(var m in f){i=new j.Sound;i.load(TWILIO_ROOT+f[m]);this.soundcache.add(m,i)}this.soundcache.cache.incoming.envelope.release=2E3;j.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;j.mixinEventEmitter(this);j.Sound.debug=this.options.debug;j.Sound.initialize({swfLocation:this.options.soundSwfLocation});var o=this;this.incoming(function(n){n.accept(function(){o.soundcache.stop("incoming")});
n.addListener("cancel",function(){o.soundcache.stop("incoming")});o.sounds.incoming()&&o.soundcache.play("incoming",0,1E3)});this.register(this.token)}function b(a,e,f,i,m){var o={objectEnc:a.options.objectEnc,chunder:a.options.host,secure:a.options.secure,debug:a.options.debug};m=m||{};for(var n in o)n in m||(m[n]=o[n]);if(f=="bridge"){m.bridgeToken=e;m.token=null}else if(f=="jwt"){m.bridgeToken=null;m.token=e}else this.log("Unknown token type: "+f);if(a.options.mediaStreamSwfLocation)m.swfLocation=
a.options.mediaStreamSwfLocation;var v=a.options.connectionFactory?a.options.connectionFactory(a,i,m):new j.Connection(a,i,m);v.accept(function(){a.fire("connect",v)}).error(function(A){a.fire("error",A);if(v.status()=="pending"){A=[].concat(a.connections);for(var x=0;x<A.length;x++)v==A[x]&&a.connections.splice(x,1)}}).cancel(function(){a.log("Canceled: "+v.parameters.CallSid);for(var A=[].concat(a.connections),x=0;x<A.length;x++)v==A[x]&&a.connections.splice(x,1);a.fire("cancel",v)}).disconnect(function(){a.fire("disconnect",
v);for(var A=[].concat(a.connections),x=0;x<A.length;x++)v==A[x]&&a.connections.splice(x,1)});return v}function d(a,e,f){if(!("client:incoming"in j.objectize(a).scope))return null;return[e+"://"+f,"2010-04-01",j.objectize(a).iss,j.objectize(a).scope["client:incoming"].params.clientName].join("/")+"?AccessToken="+a}c.prototype={makeprop:function(a,e){return function(f){return typeof f=="undefined"?a[e]:a[e]=f}}};h.toString=function(){return"[Twilio.Device class]"};h.prototype={toString:function(){return"[Twilio.Device instance]"},
register:function(a){var e=d(a,this.options.eventsScheme,this.options.eventsHost),f=this;if(e)if(this.stream){this.log("Resetting stream url to: "+e);this.stream.socket.close();this.stream.token=a;this.stream.options.reconnect=true;this.stream._tryReconnect()}else{this.log("Registering to stream with url: "+e);e={logPrefix:"[Matrix]",debug:this.options.debug,url:e};this.stream=this.options.stream||j.EventStream(a,e);this.stream.ready(function(){f.log("Stream is ready");f._status="ready";f.fire("ready",
f)}).offline(function(){f.log("Stream is offline");f._status="offline";f.fire("offline",f)}).error(function(i){f.log("Received error: ",i);f.fire("error",i)}).incoming(function(i){f.log("Message incoming...",i);switch(i.Request){case "invite":if(!i.Token){f.fire("error",{message:"Received invite without a Token"});break}if(!i.CallSid){f.fire("error",{message:"Received invite without a CallSid"});break}var m=i.Parameters||{};i=b(f,i.Token,"bridge");i.parameters=m;f.connections.push(i);f.fire("incoming",
i);break;case "cancel":m=[].concat(f.connections);for(var o=0;o<m.length;o++){var n=m[o];n.parameters.CallSid==i.CallSid&&n.status()=="pending"&&n.cancel()}}})}else{if(this.stream){this.stream.destroy();this.stream=null}this.log("Unable to receive incoming calls");setTimeout(function(){f.fire("ready",f)},0)}},connect:function(a){if(typeof a=="function")return this.addListener("connect",a);a=b(this,this.token,"jwt",a);this.connections.push(a);if(this.sounds.outgoing()){var e=this;a.accept(function(){e.soundcache.play("outgoing")})}a.accept();
return a},disconnectAll:function(){if(typeof params=="function")return this.addListener("disconnectAll",params);for(var a=[].concat(this.connections),e=0;e<a.length;e++)a[e].disconnect();this.connections.length>0&&this.log("Connections left pending: "+this.connections.length)},destroy:function(){this.stream.destroy();this.swf&&this.swf.disconnect&&this.swf.disconnect()},disconnect:function(a){this.addListener("disconnect",a)},incoming:function(a){this.addListener("incoming",a)},offline:function(a){this.addListener("offline",
a)},ready:function(a){this.addListener("ready",a)},error:function(a){this.addListener("error",a)},status:function(){return this._status}};h=function(a){var e=[],f=function(n){if(a.instance)return n();e.push(n)},i=function(n){n=(n.code?n.code+": ":"")+n.message;a.instance&&a.instance.log(n);throw new j.Exception(n);},m={instance:null,queue:f,setup:function(n,v){if(!swfobject.hasFlashPlayerVersion("10.1.0"))throw new j.Exception("Flash 10.1.0 required.");if(a.instance){a.instance.log("Found existing Device; using new token but ignoring options");
a.instance.token=n;a.instance.register(n)}else{a.instance=new h(n,v);a.sounds=a.instance.sounds;for(var A=0;A<e.length;A++)e[A]();a.ready(function(){a.instance._status="ready"});a.offline(function(){a.instance._status="offline"});a.instance.connect(function(){a.instance._status="busy"});a.instance.disconnect(function(){a.instance._status="ready"});a.incoming(function(x){if(a.status()=="busy"){a.instance.log("Device busy; ignoring incoming invite");x.cancel()}});a.error(i)}return a},connect:function(n){if(typeof n==
"function")f(function(){a.instance.addListener("connect",n)});else{if(!a.instance)throw new j.Exception("Run Twilio.Device.setup()");if(a.instance.connections.length>0)a.instance.fire("error",{message:"A connection is currently active"});else return a.instance.connect(n)}},disconnectAll:function(){f(function(){a.instance.disconnectAll()});return a},disconnect:function(n){f(function(){a.instance.addListener("disconnect",n)});return a},status:function(){return a.instance._status},ready:function(n){f(function(){a.instance.addListener("ready",
n)});return a},error:function(n){f(function(){n!=i&&a.instance.removeListener("error",i);a.instance.addListener("error",n)});return a},offline:function(n){f(function(){a.instance.addListener("offline",n)});return a},incoming:function(n){f(function(){a.instance.addListener("incoming",n)});return a},destroy:function(){a.instance&&a.instance.destroy();return a},cancel:function(n){f(function(){a.instance.addListener("cancel",n)});return a}},o;for(o in m)a[o]=m[o];return a}(h);j.Device=h})(Twilio);
(function(j){var c={},h=function(b,d){j.Device.offline(function(){for(var a in c)c.hasOwnProperty(a)&&b({available:false,from:a})});return function(a){var e=function(i){if(i.from!=d){if(i.available)c[i.from]=true;else delete c[i.from];b(i)}};if(a.EventType==="presence")e({available:a.Available,from:a.From});else if(a.EventType==="roster"){a=a.Roster||[];for(var f=0;f<a.length;f++)e({available:true,from:a[f]})}}};j.Device.prototype.presence=function(b){if(!this.presenceStream){var d={debug:this.options.debug,
host:this.options.streamHost||"stream.twilio.com"};d.url=this.options.eventsScheme+"://"+d.host+"/2010-04-01/Events?"+j.urlencode({AccessToken:this.token});this.presenceStream=j.EventStream(this.token,d)}try{var a=j.objectize(this.token).scope["client:incoming"].params.clientName}catch(e){return}this.presenceStream.incoming(h(b,a))};j.Device.presence=function(b){j.Device.queue(function(){j.Device.instance.presence(b)});return j.Device}})(Twilio);
(function(){if(!window.WebSocket){var j=window.console;if(!j||!j.log||!j.error)j={log:function(){},error:function(){}};if(swfobject.hasFlashPlayerVersion("10.0.0")){location.protocol=="file:"&&j.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://...");WebSocket=function(c,h,b,d,a){var e=this;e.__id=WebSocket.__nextId++;WebSocket.__instances[e.__id]=e;e.readyState=WebSocket.CONNECTING;e.bufferedAmount=
0;e.__events={};setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(e.__id,c,h,b||null,d||0,a||null)})},0)};WebSocket.prototype.send=function(c){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";c=WebSocket.__flash.send(this.__id,encodeURIComponent(c));if(c<0)return true;else{this.bufferedAmount+=c;return false}};WebSocket.prototype.close=function(){if(!(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING)){this.readyState=
WebSocket.CLOSING;WebSocket.__flash.close(this.__id)}};WebSocket.prototype.addEventListener=function(c,h){c in this.__events||(this.__events[c]=[]);this.__events[c].push(h)};WebSocket.prototype.removeEventListener=function(c,h){if(c in this.__events)for(var b=this.__events[c],d=b.length-1;d>=0;--d)if(b[d]===h){b.splice(d,1);break}};WebSocket.prototype.dispatchEvent=function(c){for(var h=this.__events[c.type]||[],b=0;b<h.length;++b)h[b](c);(h=this["on"+c.type])&&h(c)};WebSocket.prototype.__handleEvent=
function(c){if("readyState"in c)this.readyState=c.readyState;if(c.type=="open"||c.type=="error")c=this.__createSimpleEvent(c.type);else if(c.type=="close")c=this.__createSimpleEvent("close");else if(c.type=="message")c=this.__createMessageEvent("message",decodeURIComponent(c.message));else throw"unknown event type: "+c.type;this.dispatchEvent(c)};WebSocket.prototype.__createSimpleEvent=function(c){if(document.createEvent&&window.Event){var h=document.createEvent("Event");h.initEvent(c,false,false);
return h}else return{type:c,bubbles:false,cancelable:false}};WebSocket.prototype.__createMessageEvent=function(c,h){if(document.createEvent&&window.MessageEvent&&!window.opera){var b=document.createEvent("MessageEvent");b.initMessageEvent("message",false,false,h,null,null,window,null);return b}else return{type:c,data:h,bubbles:false,cancelable:false}};WebSocket.CONNECTING=0;WebSocket.OPEN=1;WebSocket.CLOSING=2;WebSocket.CLOSED=3;WebSocket.__flash=null;WebSocket.__instances={};WebSocket.__tasks=[];
WebSocket.__nextId=0;WebSocket.loadFlashPolicyFile=function(c){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(c)})};WebSocket.__initialize=function(){if(!WebSocket.__flash){if(WebSocket.__swfLocation)window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation;if(window.WEB_SOCKET_SWF_LOCATION){var c=document.createElement("div");c.id="webSocketContainer";c.style.position="absolute";if(WebSocket.__isFlashLite()){c.style.left="0px";c.style.top="0px"}else{c.style.left="-100px";c.style.top=
"-100px"}var h=document.createElement("div");h.id="webSocketFlash";c.appendChild(h);document.body.appendChild(c);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:true,swliveconnect:true,allowScriptAccess:"always"},null,function(b){b.success||j.error("[WebSocket] swfobject.embedSWF failed")})}else j.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf")}};WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=
document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var c=0;c<WebSocket.__tasks.length;++c)WebSocket.__tasks[c]();WebSocket.__tasks=[]},0)};WebSocket.__onFlashEvent=function(){setTimeout(function(){try{for(var c=WebSocket.__flash.receiveEvents(),h=0;h<c.length;++h)WebSocket.__instances[c[h].webSocketId].__handleEvent(c[h])}catch(b){j.error(b)}},0);return true};WebSocket.__log=function(c){j.log(decodeURIComponent(c))};
WebSocket.__error=function(c){j.error(decodeURIComponent(c))};WebSocket.__addTask=function(c){WebSocket.__flash?c():WebSocket.__tasks.push(c)};WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return false;var c=window.navigator.mimeTypes["application/x-shockwave-flash"];if(!c||!c.enabledPlugin||!c.enabledPlugin.filename)return false;return c.enabledPlugin.filename.match(/flashlite/i)?true:false};window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?
window.addEventListener("load",function(){WebSocket.__initialize()},false):window.attachEvent("onload",function(){WebSocket.__initialize()}))}else j.error("Flash Player >= 10.0.0 is required.")}})();
