{% extends "layout.html" %}

{% block head %}

<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js'></script>
<script src="{{ url_for('static', filename='twilio.min.js') }} "></script>
<script src="{{ url_for('static', filename='js/case-callback.js') }} "></script>

<script type="text/javascript">

//<![CDATA[
$(document).ready(function(){
  $("#jquery_jplayer_1").jPlayer({
    ready: function (event) {
      $(this).jPlayer("setMedia", {
        mp3:"{{ case.url }}"
      });
    },
    swfPath: "../js",
    supplied: "mp3",
    wmode: "window"
  });
});
//]]>

</script>
{# brutally overrides the bootstrap styles
<link href="{{ url_for('static', filename='jPlayer.css') }}" rel="stylesheet" type="text/css" />
#}
<link href="{{ url_for('static', filename='prettify-jPlayer.css') }}" rel="stylesheet" type="text/css" />
<link href="{{ url_for('static', filename='jplayer.blue.monday.css') }}" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="{{ url_for('static', filename='jquery.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='jquery.jplayer.min.js') }}"></script>

{% endblock %}

{% block body %}

<div class="page-header">
    <h1>{{ case.formattedTimestamp }}
        <small>Call from <a href="{{ url_for('show_patient', patientName=patientName) }}">{{ patientName }}</a></small>
    </h1>
</div>

<div class="row">

    <div class="span1">
        <div id="jquery_jplayer_1" class="jp-jplayer" style="width: 0px; height: 0px; ">
            <img id="jp_poster_0" style="width: 0px; height: 0px; display: none; " alt=''/>
            <audio id="jp_audio_0" preload="metadata" src="{{ case.url }}"></audio>
        </div>
        <div id="jp_container_1" class="jp-audio">
            <div class="jp-type-single">
                <div class="jp-gui jp-interface">
                    <ul class="jp-controls">
                        <li><a href="javascript:;" class="jp-play" tabindex="1">play</a></li>
                        <li><a href="javascript:;" class="jp-pause" tabindex="1">pause</a></li>
                        <li><a href="javascript:;" class="jp-stop" tabindex="1">stop</a></li>
                        <li><a href="javascript:;" class="jp-mute" tabindex="1" title="mute">mute</a></li>
                        <li><a href="javascript:;" class="jp-unmute" tabindex="1" title="unmute">unmute</a></li>
                        <li><a href="javascript:;" class="jp-volume-max" tabindex="1" title="max volume">max volume</a></li>
                    </ul>
                    <div class="jp-progress">
                        <div class="jp-seek-bar">
                            <div class="jp-play-bar"></div>
                        </div>
                    </div>
                    <div class="jp-volume-bar">
                        <div class="jp-volume-bar-value"></div>
                    </div>
                    <div class="jp-time-holder">
                        <div class="jp-current-time"></div>
                        <div class="jp-duration"></div>

                        <ul class="jp-toggles">
                            <li><a href="javascript:;" class="jp-repeat" tabindex="1" title="repeat">repeat</a></li>
                            <li><a href="javascript:;" class="jp-repeat-off" tabindex="1" title="repeat off">repeat off</a></li>
                        </ul>
                    </div>
                </div>

                <div class="jp-no-solution">
                    <span>Update Required</span>
                    To play the media you will need to either update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank">Flash plugin</a>.
                </div>
            </div>
        </div><!-- /jp_container_1 -->

    </div> <!-- /span -->

    <div class="offset9" style="margin-top:20px;">
        <button class="btn large primary call" id="call_button" onclick="call();">
            Call Back
        </button>
    </div>
</div>  <!-- /row -->

<br />

<div class='row'>
    <div class='span12'>

        <h4> Transcription:</h4>
        {% if not case.transcriptionText %}
        <i> Transcription not yet available.</i>
        {% else %}
        <p> {{ case.transcriptionText }} </p>
        {% endif %}

        <h4> Comments:</h4>
        {% for comment in comments %}
        <blockquote>
            <p>{{ comment.body }}</p> 
            <small class='pull-right'>
                <a href={{ url_for('show_profile', userName=comment.author) }}>{{ comment.author }}</a> 
                {{ comment.dynamicFormattedTimestamp }}
            </small>
            <br />
        </blockquote>
        {% else %}
        <i> There are not yet any comments.</i>
        {% endfor %}

    </div> <!-- /span8 -->

    <form action="{{ url_for('show_case', patientName=patientName, caseName=case.caseName) }}" method=post>
        <fieldset>
            <div class="clearfix">
                <label for="body">Leave a Comment</label>
                <div class="input">
                    <textarea class="xxlarge" id="body" name="body" rows="4"></textarea>
                    <span class="help-block">
                        any comments on what the caller had to say or how you think we should proceed
                    </span>
                </div>
            </div><!-- /clearfix -->

            <div class='clearfix' style='margin:-25px 0 0 40px'> {# should remove inline styling.. #}
                <input type="submit" class="btn success offset9" value="Comment">
            </div><!-- /clearfix -->

        </fieldset>
    </form>
</div> <!-- /row -->

<script type="text/javascript" src="{{ url_for('static', filename='prettify-jPlayer.js') }}"></script>

{% endblock %}

